<html lang="en">

<head>
    <title>Warp Chat</title>
    <style>
        html {
            background: white;
        }
    </style>
</head>

<body>
    <h1>Warp chat</h1>
    <div id="chat">
        <p><em>Connecting...</em></p>
    </div>
    <input type="text" id="roomid" placeholder="roomid" />
    <input type="text" id="token" placeholder="token" />
    <button id="connect">Connect</button>
    <button id="close">Close</button>

    <script type="text/javascript">
        const chat = document.getElementById('chat');
        const text = document.getElementById('text');
        const token = document.getElementById('token');
        const roomid = document.getElementById('roomid');

        document.getElementById('connect').onclick = () => {
            console.log('create websocket');
            let uri = `ws://localhost:3030/rooms/${encodeURIComponent(roomid.value)}/host?token=${encodeURIComponent(token.value)}`;
            console.log(uri);
            ws = new WebSocket(uri);
            console.log('blah');
            function message(data) {
                const line = document.createElement('p');
                line.innerText = data;
                chat.appendChild(line);
            }
            ws.onopen = function () {
                chat.innerHTML = '<p><em>Connected!</em></p>';
            };
            ws.onmessage = function (msg) {
                message('1: ' + msg.data);
            }
            ws.onclose = function () {
                chat.getElementsByTagName('em')[0].innerText = 'Disconnected!';
            };

            document.getElementById('close').onclick = () => {
                ws.close();
            }
        }

    </script>
</body>

</html>